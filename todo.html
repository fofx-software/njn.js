<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>f(x) todo sample app</title>
  <link rel="stylesheet" href="todo.css">
  <script type="text/javascript" src="../../js/jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="fx.js"></script>
  <script type="text/javascript" src="fx_collection.js"></script>
  <script type="text/javascript" src="fx_controller.js"></script>
</head>
<body>
  <section id="todoapp">
    <header id="header">
      <h1>todos</h1>
      <input fx-controller="newTodo" type="text" id="new-todo" placeholder="What needs to be done?" fx-on="focusout: acceptChanges; keypress: acceptOrReject"/>
    </header>

    <section id="main">
      <ul id="todo-list">
        <li fx-controller="todosEditAndDisplay" fx-watch-coll="todos" fx-toggle-class="completed editing">
          <div fx-toggle-display="editing"><input class="edit" fx-on="focusout: acceptChanges; keypress: acceptOrReject"></input></div>
          <div fx-toggle-display="!editing">
            <input type="checkbox" class="toggle" fx-on="change:completed" fx-attr-checked="completed">
            <label fx-on="dblclick:editObject">{{title}}</label><button class="destroy" fx-on="click:delete"></button>
          </div>
        </li>
      </ul>

      <input fx-controller="toggleCompleteAll" fx-watch-obj="todos" type="checkbox" id="toggle-all" fx-on="change:completeAll" fx-attr-checked="allComplete">
    </section>

    <footer id="footer">
      <span id="todo-count" fx-watch-obj="todos">
        <strong fx-filter="!completed">{{count}}</strong> of {{count}} todos left
      </span>
      <ul id="filters">
        <li>
          <a href="all" class="selected">All</a>
        </li>
        <li>
          <a href="active">Active</a>
        </li>
        <li>
          <a href="completed">Completed</a>
        </li>
      </ul>

      <button id="clear-completed">
        Clear completed (1)
      </button>
    </footer>

  </section>

  <footer id="info">
    <p>Double-click to edit a todo</p>
  </footer>
  <script>
    var todos = (new FXCollection({
      title: '',
      completed: false,
      editing: false
    })).addMembers(
      { title: 'Build f(js)', completed: true },
      { title: 'Do something with it' },
      { title: 'Profit!' }
    );

    fxjs.controller('newTodo', {
      acceptChanges: function(e) {
        var inputVal = $(e.target).val();
        if(fxjs.isBlank(inputVal)) {
          this.cancelChanges(e);
        } else {
          this.createTodo(e, inputVal);
        }
      },
      cancelChanges: function(e) {
        $(e.target).val('');
      },
      acceptOrReject: function(e) {
        if(e.which === 13) {
          this.acceptChanges(e);
        } else if(e.keyCode === 27) {
          this.cancelChanges();
        }
      },
      createTodo: function(e, title) {
        todos.addMembers({ title: title });
        this.cancelChanges(e);
      }
    });

    fxjs.controller('todosEditAndDisplay', {
      editObject: function(e, todo, index) {
        todo.set('editing', true);
        this.get(index).find('input.edit').val(todo.title).focus();
      },
      acceptChanges: function(e, todo) {
        var inputVal = $(e.target).val();
        if(fxjs.isBlank(inputVal)) {
          todo.delete();
        } else {
          todo.set('title', inputVal);
          todo.set('editing', false);
        }
      },
      acceptOrReject: function(e, todo) {
        if(e.which === 13) {
          this.acceptChanges(e, todo);
        } else if(e.keyCode === 27) {
          todo.set('editing', false);
        }
      },
    });

    fxjs.controller('toggleCompleteAll', {
      completeAll: function(e) {
        var completeAll = !todos.all('completed');
        todos.setAll('completed', completeAll);
      },
      allComplete: function() {
        return todos.all('completed');
      }
    });
  </script>
</body>
</html>
